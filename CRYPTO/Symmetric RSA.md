# pope shuffle

Category: Crypto

Points: 162

Solves: 84

>Who needs public keys?

### Solution

Looks like we are given an RSA but `e=p`, and we are given the encrypted flag and 4 chances to encode our own number. Since I'm just a god at math, we can just do this with 2 inputs:
```py
from Crypto.Util.number import long_to_bytes as ltb, bytes_to_long as btl, getPrime

p = getPrime(1024)
q = getPrime(1024)

n = p*q

e = p

with open("flag.txt", "rb") as f:
	PT = btl(f.read())

CT = pow(PT, e, n)
print(f"{CT = }")

for _ in range(4):
	CT = pow(int(input("Plaintext: ")), e, n)
	print(f"{CT = }")
```

Our first step, is to realize that `p` is odd which means that:

$$
-1^p \equiv -1 \equiv n-1 \mod n
$$

So with our first input `-1` we can add `1` to the result to get `n`. Now we just need to get `p` or `q`. Using FLT we can get `p` with this:

$$
(a^p \mod n) \equiv a^p \mod p \text{ (since p | n)} \\
a^p \equiv a \mod p \text{ (by FLT)}\\
(a^p \mod n) \equiv a \mod p \\
(a^p \mod n)-a \equiv 0 \mod p \\
$$

Since we can enter whatever `a` we want (not -1, 0, 1, and similar). We can get a multiple of `p` by taking the results of `pow(a,p,n)` and subtracting `a` from it. Now that we have `n` and a multiple of `p` we can run GCD to get `p`:



```bash
$ nc litctf.org 31783
CT = 13452385570853811757577798642113064293821189625168112074069298464584966560494197709570938457310717774630694882548769864158716496850987393516301124468192587988844432878997740774914307293496157501651758468557075497259231582091083305114583168204043564258680561246756313907296568504923205809098939159463067755190626260439926460618193617986004810107472458330446433934051912206680296619600578142670411719876594388597524441647538756988210739076270563614573790283162082359200784747177308771381194324357546532171313964109336537980819615789623999948290749685969232329205619237677220537395290865826129455107783765517708751021544
Plaintext: -1
CT = 19666448334639420240132264809699751769655350221174460645914509875689844345066271774340067287912021037646368003364200049811508059237852931490052295840215734311834347552239943907027749549571724943847972279650971561021653559332178915053906806990561096999810205309805271798639329867736862018522168648833515109421783900171120701226504054534607789599056907352530793644398120597877419696559852413632284739432076842607105793904281730954258476222134775167073535811259807699212225593048799463688135776833072740750539970564193999584874371672878093507864355565445983667969162800389975289855507131788129589957640621262815883561428
Plaintext: 2
CT = 379815665433597236534529905641013672465865735379652599894588487686018320762339537363465363827185302354193908234006678692328434201356684767910164584594387445115649959592367796601612200983672734849861307718650107007004451384020176310293523387511259795191783088739499648838831942867702518053627278057401900364750946964591101903038326415364270805371499300131536323532811112617484968166959080725917463951051172946457823636335480864678992164725595902944925328964553802927193602704812109324293256600394680915804539861198570412153765478389125232530641071802275725282285577109572031800080331478621649139440807175801304151337
```

```py
>>> ct = 13452385570853811757577798642113064293821189625168112074069298464584966560494197709570938457310717774630694882548769864158716496850987393516301124468192587988844432878997740774914307293496157501651758468557075497259231582091083305114583168204043564258680561246756313907296568504923205809098939159463067755190626260439926460618193617986004810107472458330446433934051912206680296619600578142670411719876594388597524441647538756988210739076270563614573790283162082359200784747177308771381194324357546532171313964109336537980819615789623999948290749685969232329205619237677220537395290865826129455107783765517708751021544
>>> n = 19666448334639420240132264809699751769655350221174460645914509875689844345066271774340067287912021037646368003364200049811508059237852931490052295840215734311834347552239943907027749549571724943847972279650971561021653559332178915053906806990561096999810205309805271798639329867736862018522168648833515109421783900171120701226504054534607789599056907352530793644398120597877419696559852413632284739432076842607105793904281730954258476222134775167073535811259807699212225593048799463688135776833072740750539970564193999584874371672878093507864355565445983667969162800389975289855507131788129589957640621262815883561428+1
>>> ct2 = 379815665433597236534529905641013672465865735379652599894588487686018320762339537363465363827185302354193908234006678692328434201356684767910164584594387445115649959592367796601612200983672734849861307718650107007004451384020176310293523387511259795191783088739499648838831942867702518053627278057401900364750946964591101903038326415364270805371499300131536323532811112617484968166959080725917463951051172946457823636335480864678992164725595902944925328964553802927193602704812109324293256600394680915804539861198570412153765478389125232530641071802275725282285577109572031800080331478621649139440807175801304151337
>>> p = gcd(n, ct2-2)
>>> q = n//p
>>> d = pow(p,-1,n-p-q+1)
>>> ltb(pow(ct,d,n))
b'LITCTF{ju57_u53_e=65537_00a144ca}\n'
```

### Flag

```LITCTF{ju57_u53_e=65537_00a144ca}```


